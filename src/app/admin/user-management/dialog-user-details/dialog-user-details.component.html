<mat-dialog-content class="custom-dialog-content">
  
  <mat-tab-group>

    <mat-tab label="User Information">
      <div class="dialog-container">
        <div class="dialog-header">
        <div class="header-actions">
          <button mat-raised-button (click)="onCancel()">Cancel</button>
        </div>
      </div>
      <div class="user-info" style="padding: 16px;">
        
        <p><strong>Username:</strong> {{ data.user.username }}</p>
        <p><strong>First Name:</strong> {{ data.user.fname }}</p>
        <p><strong>Last Name:</strong> {{ data.user.lname }}</p>
        <p><strong>Email:</strong> {{ data.user.email }}</p>
        <p>
          <strong>Sites Access:</strong>
          <span *ngIf="data.user.site_codes; else noSites">
            {{ data.user.site_codes.split(',').join(', ') }}
          </span>
          <ng-template #noSites>None</ng-template>
        </p>
      </div>
    </div>
    </mat-tab>

    <mat-tab label="{{ 'User Rights' }}">
      <div class="dialog-container">
        <div class="dialog-header">
          <h2 class="dialog-title">{{ data.user.username }} - User Rights</h2>
          <div class="header-actions">
            <button mat-raised-button (click)="onCancel()">Cancel</button>
            <button mat-raised-button color="primary" (click)="updateUserRights()" [disabled]="saving">Update</button>
          </div>
        </div>

        <div class="dialog-content">
          <div class="rights-container">
            <div class="rights-grid">
              <table mat-table [dataSource]="rightsGridData" class="mat-elevation-z8 rights-table">
                
                <ng-container matColumnDef="module_name">
                  <th mat-header-cell *matHeaderCellDef>Module</th>
                  <td mat-cell *matCellDef="let right">{{ right.module_name }}</td>
                </ng-container>

                
                <ng-container matColumnDef="v">
                  <th mat-header-cell *matHeaderCellDef>View</th>
                  <td mat-cell *matCellDef="let right">
                    <mat-checkbox [checked]="right.v === 1" (change)="updateCheckbox(right, 'v', $event.checked)" color="primary"></mat-checkbox>
                  </td>
                </ng-container>

                
                <ng-container matColumnDef="ro">
                  <th mat-header-cell *matHeaderCellDef>Read-Only</th>
                  <td mat-cell *matCellDef="let right">
                    <mat-checkbox [checked]="right.ro === 1" (change)="updateCheckbox(right, 'ro', $event.checked)" color="primary"></mat-checkbox>
                  </td>
                </ng-container>

                
                <ng-container matColumnDef="rw">
                  <th mat-header-cell *matHeaderCellDef>Read-Write</th>
                  <td mat-cell *matCellDef="let right">
                    <mat-checkbox [checked]="right.rw === 1" (change)="updateCheckbox(right, 'rw', $event.checked)" color="primary"></mat-checkbox>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>

            <div class="quick-actions">
              <h3>Quick Actions</h3>
              <div class="current-role">
                <span>Current Role: {{ personalRoles.length > 0 ? personalRoles.join(', ') : 'None' }}</span>
                
                <mat-checkbox [checked]="custom_selector" (change)="toggleCustomSelector($event)" color="primary">
                  Customize
                </mat-checkbox>
              </div>

              <form [formGroup]="quickActionsForm">
                <ng-container *ngIf="custom_selector">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Menu</mat-label>
                    <mat-select formControlName="menuSelector" multiple>
                      <mat-option *ngFor="let menu of menus" [value]="menu.id">
                        {{ menu.name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Action</mat-label>
                    <mat-select formControlName="actionSelector" multiple>
                      <mat-option *ngFor="let action of actions" [value]="action.id">
                        {{ action.action_name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>

                  <button mat-raised-button color="primary" (click)="loadQuickSelectionNonRole()">
                    Load
                  </button>
                </ng-container>

                <ng-container *ngIf="!custom_selector">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Role</mat-label>
                    <mat-select formControlName="commonRoleSelector">
                      <mat-option *ngFor="let role of availableRoles" [value]="role">
                        {{ role }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>

                  <button mat-raised-button color="primary" (click)="loadQuickSelectionRole()">
                    Auto Populate
                  </button>
                </ng-container>
              </form>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>
